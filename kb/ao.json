{
    "table": "ao",
    "display_name": "Archived orders",
    "alias": "ao",
    "description": "Orders In Archive",
    "fields": {
        "aoappdate": "Order Approve Date (int)",
        "aoapptime": "Order Approve Time (smallint)",
        "aobilling": "Billing status (tinyint)",
        "aocolldate": "Order Collection Date (int)",
        "aocolltime": "Order Collection Time (smallint)",
        "aocommconst": "Count of Const Commnents For Order (smallint)",
        "aocommfree": "Count of Free Commnents For Order (smallint)",
        "aodate": "Order Date (int)",
        "aodaystomove": "Number Of Days For Staying In The Archive (Before Moving To History) (smallint)",
        "aodistdate": "Order Distribution Date (int)",
        "aodisttime": "Order Distribution Time (smallint)",
        "aodlicens": "Doctor Code (int)",
        "aodoctors": "Options To Add Another Doctors For The Order (with \"|\" between the codes. rellevant only for blood bank) (nvarchar)",
        "aoflag": "user flag code (smallint)",
        "aoinschedule": "Does this requisition belong to a scheduled set? (tinyint)",
        "aolab": "Lab Code (smallint)",
        "aoordname": "Order Number (external) (nvarchar)",
        "aoordno": "Order Number (internal) (int)",
        "aoorigsender": "Original facility from reference lab - the reference lab is in main order facility (int)",
        "aoownersite": "The owner site of the order (int)",
        "aopatcode": "Patient Code (int)",
        "aopathistory": "1 - the order is relevant tot the last patient history result - filtering on patient cumulative results (tinyint)",
        "aoreference": "Unique Identifier for the Order (mask: orderNum@Site Code|Req. date|Req. time) (nvarchar)",
        "aorepetition": "Not Active (int)",
        "aosite": "order parent site (int)",
        "aosndcod": "Sender Code (int)",
        "aosource": "Not Active (tinyint)",
        "aosuspect": "Is The Patient Suspect For HIV (smallint)",
        "aotime": "Order Time (smallint)",
        "aotype": "Order Type (tinyint)",
        "aotz": "Patient ID (nvarchar)",
        "aoucod": "The User Who Opened The Order (smallint)",
        "aourgent": "Does this requisition Urgent? (tinyint)"
    },
    "joins": {
        "c": "ao.actest = c.ccode",
        "aep": "ao.aoordno = aep.epnumber",
        "ar": "ao.aoordno = ar.arordno",
        "asa": "ao.aoordno = asa.asaordno",
        "i": [
            "ao.aotz = i.itz",
            "ao.aopatcode = i.icode"
        ]
    },
    "examples": [
        {
            "query": "SELECT * FROM ao(NOLOCK) WHERE ao.aodate={order_date} AND ao.aoordno={order_number}",
            "description": "Retrieve a specific archived order by date and internal order number",
            "parameters": {
                "order_date": "Order date in YYYYMMDD format (e.g., 20250820)",
                "order_number": "Internal order number (e.g., 116113230)"
            }
        },
        {
            "query": "SELECT * FROM ao(NOLOCK) join ar(NOLOCK) on arordno=aoordno AND ardate=aodate WHERE (ao.aodate<={cutoff_date} OR (ao.aodate={target_date} AND ao.aotime<={cutoff_time})) AND NOT (ao.aoordno={excluded_order} AND ao.aodate={excluded_date}) AND ar.artest={test_code} AND ao.aopatcode={patient_code} AND ao.aodate<={max_date} AND ao.aotype<>{excluded_type} AND ar.ardynamictime=0 ORDER BY ao.aodate DESC",
            "description": "Retrieve patient orders with test results up to a specific date/time, excluding certain orders and order types, joined with archived results table",
            "parameters": {
                "cutoff_date": "Cutoff date in YYYYMMDD format (e.g., 20250819)",
                "target_date": "Target date for time comparison in YYYYMMDD format (e.g., 20250820)",
                "cutoff_time": "Cutoff time in HHMM format (e.g., 2127)",
                "excluded_order": "Order number to exclude (e.g., 116112560)",
                "excluded_date": "Date of excluded order (e.g., 20250820)",
                "test_code": "Test code from archived results (e.g., 60907231)",
                "patient_code": "Patient code (e.g., 68529913)",
                "max_date": "Maximum order date (e.g., 20250820)",
                "excluded_type": "Order type to exclude (e.g., 2)"
            }
        },
        {
            "query": "SELECT * FROM ao(NOLOCK) join ar(NOLOCK) on arordno=aoordno AND ardate=aodate WHERE (ao.aodate<={cutoff_date} OR (ao.aodate={target_date} AND ao.aotime<={cutoff_time})) AND NOT (ao.aoordno={excluded_order} AND ao.aodate={excluded_date}) AND ar.artest={test_code} AND ao.aopatcode={patient_code} AND ao.aodate<={max_date} AND ao.aotype<>{excluded_type} AND ar.ardynamictime=0 ORDER BY ao.aodate DESC",
            "description": "Retrieve patient orders with test results up to a specific date/time, excluding certain orders and order types, joined with archived results table",
            "parameters": {
                "cutoff_date": "Cutoff date in YYYYMMDD format (e.g., 20250819)",
                "target_date": "Target date for time comparison in YYYYMMDD format (e.g., 20250820)",
                "cutoff_time": "Cutoff time in HHMM format (e.g., 1336)",
                "excluded_order": "Order number to exclude (e.g., 116096215)",
                "excluded_date": "Date of excluded order (e.g., 20250820)",
                "test_code": "Test code from archived results (e.g., 30907231)",
                "patient_code": "Patient code (e.g., 68227370)",
                "max_date": "Maximum order date (e.g., 20250820)",
                "excluded_type": "Order type to exclude (e.g., 2)"
            }
        },
        {
            "query": "SELECT * FROM ao(NOLOCK) WHERE ao.aopatcode={patient_code} AND ao.aodate BETWEEN {start_date} AND {end_date} ORDER BY ao.aodate DESC, ao.aotime DESC",
            "description": "Retrieve all orders for a specific patient within a date range, ordered by most recent first",
            "parameters": {
                "patient_code": "Patient code (e.g., 12345)",
                "start_date": "Start date in YYYYMMDD format (e.g., 20240101)",
                "end_date": "End date in YYYYMMDD format (e.g., 20241231)"
            }
        },
        {
            "query": "SELECT * FROM ao(NOLOCK) WHERE ao.aodlicens={doctor_code} AND ao.aodate={order_date} AND ao.aotype<>{excluded_type}",
            "description": "Retrieve orders by doctor code for a specific date, excluding certain order types",
            "parameters": {
                "doctor_code": "Doctor code (e.g., 12345)",
                "order_date": "Order date in YYYYMMDD format (e.g., 20250820)",
                "excluded_type": "Order type to exclude (e.g., 2)"
            }
        }
    ],
    "Indexes": {
        "INDEX0_UNQ_AO": "clustered, unique located on PRIMARY (aoordno, aodate)",
        "INDEX1_AO": "nonclustered located on PRIMARY (aoordname, aodate)",
        "INDEX10_AO": "nonclustered located on PRIMARY (aoreference)",
        "INDEX2_AO": "nonclustered located on PRIMARY (aodlicens, aodate)",
        "INDEX3_AO": "nonclustered located on PRIMARY (aosndcod, aodate)",
        "INDEX4_AO": "nonclustered located on PRIMARY (aoordname, aoordno)",
        "INDEX5_AO": "nonclustered located on PRIMARY (aopatcode, aodate, aopathistory)",
        "INDEX6_AO": "nonclustered located on PRIMARY (aobilling)",
        "INDEX7_AO": "nonclustered located on PRIMARY (aodate, aoordno, aoordname)",
        "INDEX8_AO": "nonclustered located on PRIMARY (aodistdate, aodisttime)",
        "INDEX9_AO": "nonclustered located on PRIMARY (aodate, aoordno, aolab, aopatcode)"
    }
}